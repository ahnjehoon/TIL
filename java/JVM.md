
![[JavaDefault.svg]]

- 대략적인 Java 어플리케이션의 실행과정은 다음과 같음
	1. 소스 코드 작성
	2. 컴파일
	3. 클래스 로딩
	4. 실행
	5. GC 및 메모리 관리
- 1은 개발자가 .java 확장자를 가진 소스파일 만드는 단계
- 2는 소스 코드를 바이트 코드로 변환하여 .class 파일로 만드는 단계

## 클래스 로딩(Class Loading)
- Java 어플리케이션이 실행될때 JVM의 Class Loader가 클래스 파일을 메모리에 로드함
- 클래스 로딩 과정은 다음과 같음
	1. 로딩(Loading)
	   클래스 파일을 메모리에 읽어들임
	2. 연결(Linking)
		- 검증(Verification)
		  클래스 파일이 JVM 명세에 명시된 대로 구성되어 있는지 검사함
		- 준비(Preparing)
		  클래스 또는 인터페이스의 모든 클래스 변수(static variable)가 메모리에 할당됨
		  그리고 각 변수 타입에 따라 기본값으로 초기화됨
		  즉, 실제 값은 할당되지 않고 메모리 공간만 차지하는 상태
		- 해결(Resolution)
		  [[Symbolic Reference]]가 실제 메모리 주소로 변환됨
	3. 초기화(Initialization)
	   클래스 변수들을 코드에서 정의한 값으로 할당함
- 클래스 로더는 세 가지 유형으로 구분됨
	- Bootstrap ClassLoader
	  JVM 핵심 라이브러리를 로드함
	  가장 기본적인 클래스 로더
	- Extension ClassLoader
	  확장 클래스를 로드함
	  JAVA_HOME/lib/ext 에서 클래스를 로드
	- Application ClassLoader
	  사용자 정의 클래스 및 패키지를 로드함

## 실행(Execution)
- 클래스가 로드되고 초기화되면 JVM은 바이트코드를 실행함
- 

- JVM은 다음과 같은 영역으로 나뉘어짐
	1. Method Area (메서드 영역)
	2. Heap (힙)
	3. Stack (스택)
	4. PC Register (프로그램 카운터 레지스터)
	5. Native Method Stack (네이티브 메서드 스택)

## JVM Thread 호출시 메모리 구조

```text
+-----------------------------------------+
|               Method Area               |
|  +-----------------------------------+  |
|  | Class Metadata                    |  |
|  | Runtime Constant Pool             |  |
|  | Static Variables                  |  |
|  +-----------------------------------+  |
+-----------------------------------------+
|                 Heap                    |
|  +-----------------------------------+  |
|  | Young Generation                  |  |
|  |  + Eden                           |  |
|  |  + Survivor (S0, S1)              |  |
|  +-----------------------------------+  |
|  | Old Generation                    |  |
|  +-----------------------------------+  |
+-----------------------------------------+
|             Main Thread Stack           | <--- 메인 스레드 호출 스택
|  +-----------------------------------+  |
|  | Frame                             |  |
|  |  + Local Variables                |  |
|  |  + Operand Stack                  |  |
|  |  + Return Address                 |  |
|  +-----------------------------------+  |
+-----------------------------------------+
|          New Thread Stack (if any)      | <--- 새로운 스레드 호출 스택
|  +-----------------------------------+  |
|  | Frame                             |  |
|  |  + Local Variables                |  |
|  |  + Operand Stack                  |  |
|  |  + Return Address                 |  |
|  +-----------------------------------+  |
+-----------------------------------------+
|         Main Thread PC Register         | <--- 메인 스레드 명령 주소 저장
+-----------------------------------------+
|         New Thread PC Register          | <--- 새로운 스레드 명령 주소 저장
+-----------------------------------------+
|         Native Method Stack(s)          | <--- 네이티브 메서드 호출 시 사용
+-----------------------------------------+
```

